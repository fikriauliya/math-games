<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bubble Pop Math</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Nunito', sans-serif; background: linear-gradient(180deg, #0f0c29, #302b63, #24243e); color: white; min-height: 100vh; overflow: hidden; user-select: none; }
    
    .screen { width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1.5rem; padding: 2rem; }
    .hidden { display: none !important; }
    
    h1 { font-size: 2.5rem; font-weight: 900; }
    h2 { font-size: 1.1rem; opacity: 0.7; }
    .big-btn { padding: 1rem 3rem; font-size: 1.3rem; font-weight: 900; border: none; border-radius: 50px; cursor: pointer; font-family: 'Nunito'; background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
    .big-btn:active { transform: scale(0.95); }
    
    .game-hud { position: fixed; top: 0; left: 0; right: 0; display: flex; justify-content: space-between; padding: 0.8rem 1.5rem; background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); z-index: 100; }
    .hud-val { font-weight: 900; font-size: 1.2rem; }
    .hud-lbl { font-size: 0.7rem; opacity: 0.6; }
    
    .target-bar { position: fixed; top: 60px; left: 50%; transform: translateX(-50%); background: rgba(255,255,255,0.1); padding: 0.5rem 1.5rem; border-radius: 20px; font-size: 1.5rem; font-weight: 900; z-index: 100; backdrop-filter: blur(10px); }
    .target-bar .target-num { color: #f5576c; font-size: 2rem; }
    
    #game-area { position: fixed; top: 0; left: 0; right: 0; bottom: 0; }
    
    .bubble {
      position: absolute; display: flex; align-items: center; justify-content: center;
      border-radius: 50%; cursor: pointer; font-weight: 900; font-family: 'Nunito';
      animation: float-up linear forwards;
      transition: transform 0.1s;
      box-shadow: inset -5px -5px 15px rgba(0,0,0,0.2), inset 5px 5px 15px rgba(255,255,255,0.2);
    }
    .bubble:active { transform: scale(0.9); }
    
    @keyframes float-up {
      from { bottom: -80px; opacity: 0.8; }
      to { bottom: 110vh; opacity: 0.3; }
    }
    
    @keyframes pop {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.5); opacity: 0.5; }
      100% { transform: scale(0); opacity: 0; }
    }
    .bubble.popped { animation: pop 0.3s forwards !important; pointer-events: none; }
    .bubble.wrong-pop { animation: pop 0.3s forwards !important; pointer-events: none; background: #f44336 !important; }
    
    .floating-text { position: fixed; font-weight: 900; font-size: 1.5rem; pointer-events: none; animation: float-text 1s forwards; z-index: 200; }
    @keyframes float-text { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-50px); } }
    
    .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; max-width: 300px; width: 100%; }
    .stat { background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; text-align: center; }
    .stat-val { font-size: 2rem; font-weight: 900; }
    .stat-lbl { font-size: 0.8rem; opacity: 0.7; }
    
    a.back { color: rgba(255,255,255,0.6); text-decoration: none; font-size: 0.9rem; }
  </style>
</head>
<body>
  <div id="start" class="screen">
    <h1>ü´ß BUBBLE POP</h1>
    <h2>Pop the bubbles that add up to the target!</h2>
    <div style="display:flex;flex-direction:column;gap:0.8rem;max-width:280px;width:100%">
      <label style="font-weight:700;font-size:0.9rem">Mode:
        <select id="mode" style="width:100%;padding:0.5rem;border-radius:8px;border:none;font-size:1rem;font-family:Nunito;margin-top:0.3rem">
          <option value="single">Pop Singles (find the number)</option>
          <option value="pair" selected>Pop Pairs (two that sum to target)</option>
        </select>
      </label>
    </div>
    <button class="big-btn" onclick="startGame()">POP!</button>
    <a href="../" class="back">‚Üê Back to Games</a>
  </div>
  
  <div id="game" class="hidden">
    <div class="game-hud">
      <div><div class="hud-lbl">SCORE</div><div class="hud-val" id="score">0</div></div>
      <div><div class="hud-lbl">TIME</div><div class="hud-val" id="timer">60</div></div>
      <div><div class="hud-lbl">COMBO</div><div class="hud-val" id="combo">0x</div></div>
    </div>
    <div class="target-bar">Find: <span class="target-num" id="target">10</span></div>
    <div id="game-area"></div>
  </div>
  
  <div id="result" class="screen hidden">
    <h1 id="result-title">üéâ Great Job!</h1>
    <div class="stats">
      <div class="stat"><div class="stat-val" id="r-score">0</div><div class="stat-lbl">Score</div></div>
      <div class="stat"><div class="stat-val" id="r-popped">0</div><div class="stat-lbl">Popped</div></div>
      <div class="stat"><div class="stat-val" id="r-missed">0</div><div class="stat-lbl">Missed</div></div>
      <div class="stat"><div class="stat-val" id="r-combo">0</div><div class="stat-lbl">Best Combo</div></div>
    </div>
    <button class="big-btn" onclick="location.reload()">PLAY AGAIN</button>
    <a href="../" class="back">‚Üê Back to Games</a>
  </div>

  <script>
    let s = {};
    const colors = ['#f093fb','#f5576c','#00d2ff','#3a7bd5','#ffd700','#4caf50','#ff6b6b','#a29bfe','#fd79a8','#00cec9'];
    
    function startGame() {
      s = { score: 0, popped: 0, missed: 0, combo: 0, bestCombo: 0, time: 60,
        mode: document.getElementById('mode').value, target: 0, selected: null, bubbles: [] };
      document.getElementById('start').classList.add('hidden');
      document.getElementById('game').classList.remove('hidden');
      newTarget();
      s.spawnInterval = setInterval(spawnBubble, 800);
      s.timerInterval = setInterval(() => {
        s.time--;
        document.getElementById('timer').textContent = s.time;
        if (s.time <= 0) endGame();
      }, 1000);
      // Spawn initial batch
      for (let i = 0; i < 6; i++) setTimeout(() => spawnBubble(), i * 200);
    }
    
    function newTarget() {
      s.target = s.mode === 'single' ? Math.floor(Math.random() * 20) + 1 : Math.floor(Math.random() * 15) + 5;
      document.getElementById('target').textContent = s.target;
      s.selected = null;
    }
    
    function spawnBubble() {
      if (s.time <= 0) return;
      const area = document.getElementById('game-area');
      const div = document.createElement('div');
      
      // Ensure some bubbles are correct answers
      let num;
      if (Math.random() < 0.3) {
        if (s.mode === 'single') num = s.target;
        else num = Math.floor(Math.random() * (s.target - 1)) + 1; // valid pair component
      } else {
        num = Math.floor(Math.random() * 20) + 1;
      }
      
      const size = 55 + Math.random() * 25;
      const color = colors[Math.floor(Math.random() * colors.length)];
      const x = Math.random() * (window.innerWidth - size);
      const duration = 6 + Math.random() * 4;
      
      div.className = 'bubble';
      div.textContent = num;
      div.dataset.num = num;
      div.style.cssText = `width:${size}px;height:${size}px;left:${x}px;font-size:${size*0.35}px;background:${color};animation-duration:${duration}s;`;
      
      div.addEventListener('click', () => popBubble(div, num));
      div.addEventListener('touchstart', (e) => { e.preventDefault(); popBubble(div, num); }, {passive: false});
      
      area.appendChild(div);
      setTimeout(() => { if (div.parentNode) div.remove(); }, duration * 1000);
    }
    
    function popBubble(el, num) {
      if (s.mode === 'single') {
        if (num === s.target) {
          el.classList.add('popped');
          s.popped++; s.combo++; s.score += 10 * Math.min(s.combo, 5);
          if (s.combo > s.bestCombo) s.bestCombo = s.combo;
          showFloat(el, '+' + (10 * Math.min(s.combo, 5)), '#4caf50');
          setTimeout(() => { el.remove(); newTarget(); }, 300);
        } else {
          el.classList.add('wrong-pop');
          s.missed++; s.combo = 0;
          showFloat(el, '‚úï', '#f44336');
          setTimeout(() => el.remove(), 300);
        }
      } else {
        // Pair mode
        if (!s.selected) {
          s.selected = { el, num };
          el.style.border = '3px solid white';
          el.style.boxShadow = '0 0 20px rgba(255,255,255,0.5)';
        } else {
          if (s.selected.num + num === s.target) {
            s.selected.el.classList.add('popped');
            el.classList.add('popped');
            s.popped += 2; s.combo++; s.score += 20 * Math.min(s.combo, 5);
            if (s.combo > s.bestCombo) s.bestCombo = s.combo;
            showFloat(el, '+' + (20 * Math.min(s.combo, 5)), '#4caf50');
            setTimeout(() => { s.selected.el.remove(); el.remove(); newTarget(); }, 300);
          } else {
            s.selected.el.style.border = 'none';
            s.selected.el.style.boxShadow = '';
            s.missed++; s.combo = 0;
            showFloat(el, s.selected.num + '+' + num + '‚â†' + s.target, '#f44336');
            s.selected = null;
          }
        }
      }
      updateHUD();
    }
    
    function showFloat(el, text, color) {
      const f = document.createElement('div');
      f.className = 'floating-text';
      f.textContent = text;
      f.style.color = color;
      f.style.left = el.style.left;
      f.style.top = el.getBoundingClientRect().top + 'px';
      document.body.appendChild(f);
      setTimeout(() => f.remove(), 1000);
    }
    
    function updateHUD() {
      document.getElementById('score').textContent = s.score;
      document.getElementById('combo').textContent = s.combo + 'x';
    }
    
    function endGame() {
      clearInterval(s.spawnInterval);
      clearInterval(s.timerInterval);
      document.getElementById('game').classList.add('hidden');
      document.getElementById('result').classList.remove('hidden');
      document.getElementById('r-score').textContent = s.score;
      document.getElementById('r-popped').textContent = s.popped;
      document.getElementById('r-missed').textContent = s.missed;
      document.getElementById('r-combo').textContent = s.bestCombo;
      document.getElementById('result-title').textContent = s.score >= 500 ? 'üèÜ AMAZING!' : s.score >= 200 ? '‚≠ê Great Job!' : 'üí™ Keep Going!';
    }
  </script>
</body>
</html>
