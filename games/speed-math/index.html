<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Math Racer</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Nunito', sans-serif; background: #1a1a2e; color: white; min-height: 100vh; display: flex; flex-direction: column; align-items: center; overflow: hidden; }
    
    .screen { width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1.5rem; padding: 2rem; }
    .hidden { display: none !important; }
    
    #start h1 { font-size: 2.5rem; font-weight: 900; background: linear-gradient(135deg, #00d2ff, #3a7bd5); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    #start h2 { font-size: 1.2rem; opacity: 0.7; }
    
    .settings { display: flex; flex-direction: column; gap: 0.8rem; width: 100%; max-width: 280px; }
    .settings label { font-size: 0.9rem; font-weight: 700; display: flex; flex-direction: column; }
    .settings select { padding: 0.5rem; border-radius: 8px; border: none; font-size: 1rem; font-family: 'Nunito'; margin-top: 0.3rem; }
    
    .big-btn { padding: 1rem 3rem; font-size: 1.3rem; font-weight: 900; border: none; border-radius: 50px; cursor: pointer; font-family: 'Nunito'; background: linear-gradient(135deg, #00d2ff, #3a7bd5); color: white; box-shadow: 0 4px 20px rgba(0,210,255,0.3); }
    .big-btn:active { transform: scale(0.95); }
    
    /* Game */
    .hud { display: flex; justify-content: space-between; width: 100%; padding: 1rem; }
    .hud-item { text-align: center; }
    .hud-label { font-size: 0.7rem; opacity: 0.6; text-transform: uppercase; }
    .hud-value { font-size: 1.5rem; font-weight: 900; }
    
    .road { flex: 1; width: 100%; max-width: 400px; position: relative; background: #16213e; border-radius: 20px; overflow: hidden; margin: 0.5rem 0; }
    .lane-lines { position: absolute; width: 4px; left: 50%; top: 0; bottom: 0; transform: translateX(-50%); }
    .lane-line { position: absolute; width: 4px; height: 30px; background: #e2e8f0; border-radius: 2px; left: 0; animation: road-scroll 1s linear infinite; }
    @keyframes road-scroll { from { transform: translateY(-60px); } to { transform: translateY(calc(100vh)); } }
    
    .car { position: absolute; bottom: 20%; font-size: 3rem; transition: left 0.3s; left: 50%; transform: translateX(-50%); }
    .obstacle { position: absolute; font-size: 2rem; transition: top 0.1s linear; }
    
    .question-bar { width: 100%; max-width: 400px; text-align: center; padding: 0.5rem; }
    .q-text { font-size: 2rem; font-weight: 900; margin-bottom: 0.5rem; }
    .choices { display: flex; gap: 0.5rem; justify-content: center; }
    .choice-btn { flex: 1; max-width: 100px; padding: 0.8rem; font-size: 1.3rem; font-weight: 800; border: 2px solid #3a7bd5; border-radius: 12px; background: transparent; color: white; cursor: pointer; font-family: 'Nunito'; }
    .choice-btn:active { background: #3a7bd5; }
    .choice-btn.correct { background: #4caf50; border-color: #4caf50; }
    .choice-btn.wrong { background: #f44336; border-color: #f44336; }
    
    .combo { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 3rem; font-weight: 900; pointer-events: none; opacity: 0; transition: all 0.5s; }
    .combo.show { opacity: 1; transform: translate(-50%, -70%); }
    
    .streak-bar { width: 100%; max-width: 400px; height: 6px; background: #16213e; border-radius: 3px; overflow: hidden; }
    .streak-fill { height: 100%; background: linear-gradient(90deg, #00d2ff, #ff6b6b); transition: width 0.3s; width: 0%; border-radius: 3px; }
    
    /* Result */
    .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; width: 100%; max-width: 300px; }
    .stat { background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 12px; text-align: center; }
    .stat-value { font-size: 2rem; font-weight: 900; }
    .stat-label { font-size: 0.8rem; opacity: 0.7; }
    .grade { font-size: 4rem; font-weight: 900; margin: 0.5rem 0; }
    
    a.back { color: rgba(255,255,255,0.6); text-decoration: none; font-size: 0.9rem; }
  </style>
</head>
<body>
  <div id="start" class="screen">
    <h1>üèéÔ∏è MATH RACER</h1>
    <h2>Answer fast. Drive faster.</h2>
    <div class="settings">
      <label>Difficulty: <select id="diff"><option value="easy">Easy</option><option value="medium" selected>Medium</option><option value="hard">Hard</option></select></label>
      <label>Questions: <select id="qcount"><option value="10">10</option><option value="20" selected>20</option><option value="30">30</option></select></label>
    </div>
    <button class="big-btn" onclick="startGame()">RACE!</button>
    <a href="../" class="back">‚Üê Back to Games</a>
  </div>
  
  <div id="game" class="screen hidden">
    <div class="hud">
      <div class="hud-item"><div class="hud-label">Score</div><div class="hud-value" id="score">0</div></div>
      <div class="hud-item"><div class="hud-label">Streak</div><div class="hud-value" id="streak">0üî•</div></div>
      <div class="hud-item"><div class="hud-label">Left</div><div class="hud-value" id="left">20</div></div>
    </div>
    <div class="streak-bar"><div class="streak-fill" id="streak-fill"></div></div>
    <div class="road" id="road">
      <div class="lane-lines" id="lanes"></div>
      <div class="car" id="car">üèéÔ∏è</div>
    </div>
    <div class="question-bar">
      <div class="q-text" id="q-text">5 + 3 = ?</div>
      <div class="choices" id="choices"></div>
    </div>
    <div class="combo" id="combo"></div>
  </div>
  
  <div id="result" class="screen hidden">
    <h1 id="grade-text">üèÜ</h1>
    <div class="grade" id="grade">A+</div>
    <div class="stats">
      <div class="stat"><div class="stat-value" id="r-correct">0</div><div class="stat-label">Correct</div></div>
      <div class="stat"><div class="stat-value" id="r-wrong">0</div><div class="stat-label">Wrong</div></div>
      <div class="stat"><div class="stat-value" id="r-streak">0</div><div class="stat-label">Best Streak</div></div>
      <div class="stat"><div class="stat-value" id="r-score">0</div><div class="stat-label">Score</div></div>
    </div>
    <button class="big-btn" onclick="location.reload()">RACE AGAIN</button>
    <a href="../" class="back">‚Üê Back to Games</a>
  </div>

  <script>
    let state = {};
    
    function genQ(diff) {
      const max = { easy: 10, medium: 20, hard: 50 }[diff];
      const ops = diff === 'easy' ? ['+'] : diff === 'medium' ? ['+', '‚àí'] : ['+', '‚àí', '√ó'];
      const op = ops[Math.floor(Math.random() * ops.length)];
      let a, b, ans;
      if (op === '√ó') { a = Math.floor(Math.random()*12)+1; b = Math.floor(Math.random()*12)+1; ans = a*b; }
      else if (op === '‚àí') { a = Math.floor(Math.random()*max)+1; b = Math.floor(Math.random()*a)+1; ans = a-b; }
      else { a = Math.floor(Math.random()*max)+1; b = Math.floor(Math.random()*max)+1; ans = a+b; }
      
      // Generate 4 choices
      const choices = new Set([ans]);
      while (choices.size < 4) {
        let wrong = ans + Math.floor(Math.random()*10) - 5;
        if (wrong !== ans && wrong >= 0) choices.add(wrong);
      }
      return { text: `${a} ${op} ${b} = ?`, answer: ans, choices: [...choices].sort((a,b) => a-b) };
    }
    
    function startGame() {
      state = { score: 0, correct: 0, wrong: 0, streak: 0, bestStreak: 0, qIdx: 0,
        diff: document.getElementById('diff').value,
        total: parseInt(document.getElementById('qcount').value) };
      document.getElementById('start').classList.add('hidden');
      document.getElementById('game').classList.remove('hidden');
      // Create lane lines
      const lanes = document.getElementById('lanes');
      lanes.innerHTML = '';
      for (let i = 0; i < 20; i++) {
        const line = document.createElement('div');
        line.className = 'lane-line';
        line.style.top = (i * 60) + 'px';
        line.style.animationDelay = (i * -0.15) + 's';
        lanes.appendChild(line);
      }
      nextQ();
    }
    
    function nextQ() {
      if (state.qIdx >= state.total) return endGame();
      const q = genQ(state.diff);
      state.currentQ = q;
      document.getElementById('q-text').textContent = q.text;
      document.getElementById('left').textContent = state.total - state.qIdx;
      
      const div = document.getElementById('choices');
      div.innerHTML = '';
      q.choices.forEach(c => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.textContent = c;
        btn.onclick = () => answer(c, btn);
        div.appendChild(btn);
      });
    }
    
    function answer(val, btn) {
      const correct = val === state.currentQ.answer;
      document.querySelectorAll('.choice-btn').forEach(b => b.onclick = null);
      
      if (correct) {
        btn.classList.add('correct');
        state.correct++;
        state.streak++;
        if (state.streak > state.bestStreak) state.bestStreak = state.streak;
        const bonus = Math.min(state.streak, 5);
        state.score += 10 * bonus;
        if (state.streak >= 3) showCombo(state.streak);
      } else {
        btn.classList.add('wrong');
        document.querySelectorAll('.choice-btn').forEach(b => { if (parseInt(b.textContent) === state.currentQ.answer) b.classList.add('correct'); });
        state.wrong++;
        state.streak = 0;
      }
      
      document.getElementById('score').textContent = state.score;
      document.getElementById('streak').textContent = state.streak + 'üî•';
      document.getElementById('streak-fill').style.width = Math.min(state.streak / 10 * 100, 100) + '%';
      
      // Move car
      const car = document.getElementById('car');
      car.style.left = correct ? (30 + Math.random() * 40) + '%' : '50%';
      
      state.qIdx++;
      setTimeout(nextQ, correct ? 400 : 1000);
    }
    
    function showCombo(n) {
      const el = document.getElementById('combo');
      el.textContent = `${n}x COMBO! üî•`;
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 800);
    }
    
    function endGame() {
      document.getElementById('game').classList.add('hidden');
      document.getElementById('result').classList.remove('hidden');
      const pct = state.correct / state.total * 100;
      const grade = pct >= 95 ? 'S' : pct >= 90 ? 'A+' : pct >= 80 ? 'A' : pct >= 70 ? 'B' : pct >= 60 ? 'C' : 'D';
      document.getElementById('grade').textContent = grade;
      document.getElementById('grade-text').textContent = pct >= 90 ? 'üèÜ AMAZING!' : pct >= 70 ? '‚≠ê Great Job!' : 'üí™ Keep Practicing!';
      document.getElementById('r-correct').textContent = state.correct;
      document.getElementById('r-wrong').textContent = state.wrong;
      document.getElementById('r-streak').textContent = state.bestStreak;
      document.getElementById('r-score').textContent = state.score;
    }
  </script>
</body>
</html>
